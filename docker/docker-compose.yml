services:
  isaac-sim:
    image: nvcr.io/nvidia/isaac-sim:${ISAAC_SIM_VERSION:-4.1.0}
    container_name: isaac-sim
    environment:
      - ACCEPT_EULA=${ACCEPT_EULA:-Y}
      - PRIVACY_CONSENT=Y
      - DISPLAY=${DISPLAY}
      - WAYLAND_DISPLAY=${WAYLAND_DISPLAY}
      - XDG_RUNTIME_DIR=${XDG_RUNTIME_DIR}
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
      - OMNI_KIT_ALLOW_ROOT=1
    volumes:
      # Display
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ${XDG_RUNTIME_DIR}/${WAYLAND_DISPLAY}:${XDG_RUNTIME_DIR}/${WAYLAND_DISPLAY}
      # Shared memory and persistence
      - /dev/shm:/dev/shm
      - ../data:/isaac-sim/my_data
      - ../assets:/isaac-sim/assets
      - ../configs:/isaac-sim/configs
      - ../scripts:/isaac-sim/scripts_local
      # Hardware
      - /dev:/dev
    network_mode: host
    devices:
      - nvidia.com/gpu=all
    entrypoint:
      - /bin/bash
      - -c
      - |
        # Standby Mode: Keep container alive but idle
        echo "Container started in standby mode. Use 'make gui' or 'make sim' to launch applications."
        sleep infinity
